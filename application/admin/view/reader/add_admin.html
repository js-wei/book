<include file="public/header" title="{$model.name}" keywords="{$model.name}"/>
<div class="col-lg-12 col-sm-12 col-xs-12">
    <div class="widget  radius-bordered">
        <div class="widget-header">
            <span class="widget-caption">控制器操作</span>
        </div>
        <div class="widget-body">
            <form id="togglingForm" action="__URL__/add_admin_handler" method="post" class="form-horizontal" autocomplete="off">
                <div class="form-group">
                    <label class="col-lg-2 col-xs-3 col-md-3 control-label">账号<sup class="text-danger">*</sup></label>
                    <div class="col-lg-3">
                    	<notempty name="info.username">
                    		<label class="text-success pt10">{$info.username}</label>
                    		<else/>
                    		<input type="text" name="username" value="<notempty name="info">{$info.username}</notempty>" class="form-control" id="name" placeholder="请输入邮箱"/>
                    	</notempty>
                        <input type="hidden" name="id" value="<notempty name='info'>{$info.id}</notempty>">
                    </div>
                </div>
                <notempty name="info">
                	<div class="form-group">
	                    <label class="col-lg-2 col-xs-3 col-md-3 control-label">忘记密码<sup class="text-danger">*</sup></label>
	                    <div class="col-lg-3">
	                    	 <a href="__URL__/reset_password" data-role="{$info.id}" class="btn btn-primary reset_password">重置密码</a>
	                    </div>
	                </div>
                	<else/>
                	<div class="form-group">
	                    <label class="col-lg-2 col-xs-3 col-md-3 control-label">密码<sup class="text-danger">*</sup></label>
	                    <div class="col-lg-3">
	                    	 <input type="password" name="password" value="<notempty name="info">{$info.password}</notempty>" class="form-control" placeholder="请输入密码"/>
	                    </div>
	                </div>
	                <div class="form-group">
	                    <label class="col-lg-2 col-xs-3 col-md-3 control-label">确认密码<sup class="text-danger">*</sup></label>
	                    <div class="col-lg-3">
	                    	 <input type="password" name="confirmPassword" class="form-control" placeholder="请输入密码"/>
	                    </div>
	                </div>
                </notempty>
                <div class="form-group">
                    <label class="col-lg-2 col-xs-3 col-md-3 control-label">权限<sup class="text-danger">*</sup></label>
                    <div class="col-lg-9">
                        <volist name="action" id="act">
                        	<div class="col-lg-1 col-sm-2 col-xs-6" style="padding-left:0;">
                    			<div class="checkbox">
									<label style="padding-left:0;">
										<input type="checkbox" name="gid[]" value="{$act.id}" class="colored-blue" <eq name="act.checked" value="1">checked</eq>>
										<span class="text">{$act.name}</span>
									</label>
								</div>
                    		</div>
                        </volist>
                        <div class="checkbox hide">
							<label style="padding-left:0;">
								<input type="checkbox" name="gid[]"  class="colored-blue">
								<span class="text"></span>
							</label>
						</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-2 col-xs-3 col-md-3 control-label">状态</label>
                    <div class="col-lg-6">
                        <div class="radio pull-left">
                            <label style="padding-left:0;padding-right:15px;">
                                <input name="status" type="radio" value="0" class="colored-success" <notempty name="info"><eq name="info.status" value="0">checked="checked"</eq><else />checked="checked"</notempty>>
                                <span class="text">正常</span>
                            </label>
                        </div>
                        <div class="radio pull-left">
                            <label style="padding-left:0;padding-right:15px;">
                                <input name="status" type="radio" value="1" class="colored-warning" <notempty name="info"><eq name="info.status" value="1">checked="checked"</eq></notempty>>
                                <span class="text">禁用</span>
                            </label>
                        </div>
                        <div class="radio hide">
                            <label>
                                <input name="status" type="radio" class="colored-blueberry">
                                <span class="text"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <hr class="wide" />
                <div class="form-group">
                    <div class="col-lg-4 col-lg-offset-2">
                        <button type="submit" class="btn btn-danger col-lg-2">提交</button>
                        <button type="button" class="btn btn-warning col-lg-2 ml10" onclick="window.history.go(-1);">返回</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<js file="__JS__/validation/bootstrapValidator.js"/>
<script type="text/javascript">
	$(function(){
		$('#togglingForm').bootstrapValidator({
            message: '验证没有通过',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            submitHandler: function (validator, form, submitButton) {
                var index = layer.load(2,{
                    shade: [0.4,'#000'] //0.1透明度的白色背景
                });
                $.post(form.attr('action'),form.serialize(),function(data){
                    layer.close(index);
                    if(data.status==1){
                        layer.alert(data.msg,{icon:6,end:function(){
                            location.href = data.redirect;
                        }});
                    }else {
                        layer.alert(data.msg,{icon:5});
                    }
                });
            },
            fields: {
                'username': {
                    validators: {
                        notEmpty: {
                            message: '请输入账号'
                        },
                        emailAddress:{
                        	 message: '请输入正确的邮箱'
                        }
                    }
                },
                'password': {
                    validators: {
                        notEmpty: {
                            message: '请输入密码'
                        }
                    }
                },
                confirmPassword: {
		            validators: {
		            	notEmpty: {
                            message: '请输入确认密码'
                       },
		                identical: {
		                    field: 'password',
		                    message: '两次密码不一致'
		                }
		            }
		        },
                'gid[]': {
                    validators: {
                        notEmpty: {
                            message: '至少选择一个权限'
                        }
                    }
                }
            }
        })
        .find('button[data-toggle]')
        .on('click', function () {
            var $target = $($(this).attr('data-toggle'));
            $target.toggle();
            if (!$target.is(':visible')) {
                $('#togglingForm').data('bootstrapValidator').disableSubmitButtons(false);
            }
        });
        $('.reset_password').on('click',function(e){
        	e.preventDefault();
        	let el = $(this),url = el.attr('href'),id=el.attr('data-role');
        	layer.confirm('您确定要重置!', {
              btn: ['是的确定','不没想好'] //按钮
            }, function(){
                var index = layer.load(2, {
                    shard: [0.6, "#000"]
                });
                $.post(url,{id:id},function(result){
                    layer.close(index);
                    layer.alert(result.msg, {
                        icon: 6,
                        end: function() {
                            if(result.redirect!=''){
                                window.location.href=result.redirect;
                            }else{
                                layer.alert('密码已重置成初始密码：123456，请尽快登录修改密码');
                            }
                        }
                    }); 
                });
            });
        });
	});
</script>
<include file="public/footer"/>