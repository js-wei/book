<include file="public/header" title="{$model.name}" keywords="{$model.name}"/>
<div class="col-lg-12 col-sm-12 col-xs-12">
    <div class="widget  radius-bordered">
        <div class="widget-header">
            <span class="widget-caption">文章采集操作</span>
        </div>
        <div class="widget-body">
            <form id="togglingForm" action="__URL__/add_handler" method="post" enctype="multipart/form-data" class="form-horizontal" autocomplete="off">
                <div class="form-group">
                    <label class="col-lg-1 control-label">文章采集标题<sup>*</sup></label>
                    <div class="col-lg-4">
                        <input type="text" name="title" value="<notempty name="info">{$info.title}</notempty>" class="form-control" id="name" placeholder="文章采集标题"/>
                        <input type="hidden" name="id" value="<notempty name='info'>{$info.id}</notempty>">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-1 control-label">文章采集说明</label>
                    <div class="col-lg-4">
                        <textarea name="description" class="form-control" rows="6" placeholder="文章采集说明"><notempty name="info">{$info.description}</notempty></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-1 control-label">文章采集地址<sup>*</sup></label>
                    <div class="col-lg-4">
                        <input type="url" name="url" value="<notempty name="info">{$info.url}</notempty>" class="form-control" id="url" placeholder="文章采集地址"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-1 control-label">采集目标栏目<sup>*</sup></label>
                    <div class="col-lg-4">
                        <input type="text" name="tit" value="<notempty name="info">{$info.tit}</notempty>" class="form-control" id="url" placeholder="采集目标栏目"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-1 control-label">文章采集类型<sup>*</sup></label>
                    <div class="col-lg-4">
                        <div class="radio pull-left">
                            <label>
                                <input name="type" type="radio" value="1" class="colored-danger" <notempty name="info"><eq name="info.status" value="0">checked="checked"</eq><else />checked="checked"</notempty>>
                                <span class="text">列表页面</span>
                            </label>
                        </div>
                        <div class="radio pull-left">
                            <label>
                                <input name="type" type="radio" value="0" class="colored-success" <notempty name="info"><eq name="info.status" value="1">checked="checked"</eq></notempty>>
                                <span class="text">内容页面</span>
                            </label>
                        </div>
                        <div class="radio hide">
                            <label>
                                <input name="type" type="radio" class="colored-blueberry">
                                <span class="text"></span>
                            </label>
                        </div>
                    </div>
                </div>
               </empty>
            	<div class="form-group list-rule"<eq name="type" value="0">style="display:none;"</eq> >
                    <label class="col-lg-1 control-label">文章采集规则<sup>*</sup></label>
                    <div class="col-lg-4">
                    	<div class="rule">
                    		<div class="col-lg-12 col-md-12 text-right mt10">
                    			<span>列表采集规则</span>
	                    		<i class="fa fa-plus plus" style="display:inline-block;width:20px;height:20px;cursor:pointer;"></i>
	                    		<i class="fa fa-minus minus" style="display:inline-block;width:20px;height:20px;cursor:pointer;"></i>
	                    	</div>
                        	<empty name="list">
                        		<div>
	                        		<div class="col-lg-5 mt10">
				                       	<label>采集名称</label>
				                       	<input type="text" name="rule[list][key][]" value="" class="form-control" id="url" placeholder="采集名称"/>
			                        </div>
			                        <div class="col-lg-7 mt10">
				                       	<label>采集字段</label>
				                       	<input type="text" name="rule[list][value][]" value="" class="form-control" id="url" placeholder="采集字段"/>
			                        </div>
	                        	</div>
	                        	<else />
	                        	
	                        	<volist name="list" id="ls">
	                        		<div>
		                        		<div class="col-lg-5 mt10">
					                       	<label>采集名称</label>
					                       	<input type="text" name="rule[list][key][]" value='{$key}' class="form-control" id="url" placeholder="采集名称"/>
				                        </div>
				                        <div class="col-lg-7 mt10">
					                       	<label>采集字段</label>
					                       	<input type="text" name="rule[list][value][]" value='{$ls}' class="form-control" id="url" placeholder="采集字段"/>
				                        </div>
		                        	</div>
	                        	</volist>
                        	</empty>
                       </div>
                       <div class="rule">
                    		<div class="col-lg-12 col-md-12 text-right mt10">
                    			<span>内容采集规则</span>
	                    		<i class="fa fa-plus plus" style="display:inline-block;width:20px;height:20px;cursor:pointer;"></i>
	                    		<i class="fa fa-minus minus" style="display:inline-block;width:20px;height:20px;cursor:pointer;"></i>
	                    	</div>
	                    	<empty name="$content">
	                    		<div>
	                        		<div class="col-lg-5 mt10">
				                       	<label>采集名称</label>
				                       	<input type="text" name="rule[content][key][]" value="" class="form-control" id="url" placeholder="采集名称"/>
			                        </div>
			                        <div class="col-lg-7 mt10">
				                       	<label>采集字段</label>
				                       	<input type="text" name="rule[content][value][]" value="" class="form-control" id="url" placeholder="采集字段"/>
			                        </div>
	                        	</div>
	                        	<else />
	                        	<volist name="content" id="con">
	                        		<div>
		                        		<div class="col-lg-5 mt10">
					                       	<label>采集名称</label>
					                       	<input type="text" name="rule[content][key][]" value='{$key}' class="form-control" id="url" placeholder="采集名称"/>
				                        </div>
				                        <div class="col-lg-7 mt10">
					                       	<label>采集字段</label>
					                       	<input type="text" name="rule[content][value][]" value='{$con}' class="form-control" id="url" placeholder="采集字段"/>
				                        </div>
		                        	</div>
	                        	</volist>
	                    	</empty>	                        	
                       </div>
                    </div>
                </div>
                <div class="form-group content-rule" <eq name="type" value="1">style="display:none;"</eq>>
                    <label class="col-lg-1 control-label">文章采集规则<sup>*</sup></label>
                    <div class="col-lg-4 append-content">
                        <div class="rule">
                    		<div class="col-lg-12 col-md-12 text-right mt10">
                    			<span>内容采集规则</span>
	                    		<i class="fa fa-plus plus" style="display:inline-block;width:20px;height:20px;cursor:pointer;"></i>
	                    		<i class="fa fa-minus minus" style="display:inline-block;width:20px;height:20px;cursor:pointer;"></i>
	                    	</div>
                        	<div>
                        		<div class="col-lg-6 mt10">
			                       	<label>采集名称</label>
			                       	<input type="text" name="rule[content][key][]" value="" class="form-control" id="url" placeholder="采集名称"/>
		                        </div>
		                        <div class="col-lg-6 mt10">
			                       	<label>采集字段</label>
			                       	<input type="text" name="rule[content][value][]" value="" class="form-control" id="url" placeholder="采集字段"/>
		                        </div>
                        	</div>
                       </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-1 control-label">状态</label>
                    <div class="col-lg-4">
                        <div class="radio pull-left">
                            <label>
                                <input name="status" type="radio" value="0" class="colored-success" <notempty name="info"><eq name="info.status" value="0">checked="checked"</eq><else />checked="checked"</notempty>>
                                <span class="text">是</span>
                            </label>
                        </div>
                        <div class="radio pull-left">
                            <label>
                                <input name="status" type="radio" value="1" class="colored-danger" <notempty name="info"><eq name="info.status" value="1">checked="checked"</eq></notempty>>
                                <span class="text">否</span>
                            </label>
                        </div>
                        <div class="radio hide">
                            <label>
                                <input name="status" type="radio" class="colored-blueberry">
                                <span class="text"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <hr class="wide" />
                <div class="form-group">
                    <div class="col-lg-4 col-lg-offset-1">
                        <button type="submit" class="btn btn-danger col-lg-2">提交</button>
                        <button type="button" class="btn btn-warning col-lg-2 ml10" onclick="window.history.go(-1);">返回</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<js file="__JS__/validation/bootstrapValidator.js"/>
<script type="text/javascript">
    $(function(){
    	$('.plus').on('click',function(e){
    		e.preventDefault();
    		var html = $(this).parent('div').next().clone();
    		$(this).parent('div').parent().append(html);
    	});
    	$('.minus').on('click',function(e){
    		e.preventDefault();
    		alert('-');
    	});
    	$('input[name="type"]').change(function(){
    		var value = $(this).val();
    		if(value==0){
    			$('.content-rule').show();
    			$('.list-rule').hide();
    		}else{
    			$('.content-rule').hide();
    			$('.list-rule').show();
    		}
    	});
        $('#togglingForm').bootstrapValidator({
            message: '验证没有通过',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            submitHandler: function (validator, form, submitButton) {
                var index = layer.load(2,{
                    shade: [0.4,'#000'] //0.1透明度的白色背景
                });
                $.post(form.attr('action'),form.serialize(),function(data){
                    layer.close(index);
                    if(data.status==1){
                        layer.alert(data.msg,{icon:6,end:function(){
                            location.href = data.redirect;
                        }});
                    }else {
                        layer.alert(data.msg,{icon:5});
                    }
                });
            },
            fields: {
                title: {
                    validators: {
                        notEmpty: {
                            message: '请输入文章采集名称'
                        }
                    }
                },
                url:{
                    validators: {
                        notEmpty: {
                            message: '请输入采集地址'
                        }
                    }
                },
                rule:{
                	validators: {
                        notEmpty: {
                            message: '请输入采集规则'
                        }
                    }
                }
            }
        })
        .find('button[data-toggle]')
        .on('click', function () {
            var $target = $($(this).attr('data-toggle'));
            $target.toggle();
            if (!$target.is(':visible')) {
                $('#togglingForm').data('bootstrapValidator').disableSubmitButtons(false);
            }
        });
    });
</script>
<include file="public/footer"/>